# CNIC Text Extraction API

REST API for extracting structured text data from Pakistani CNIC (Computerized National Identity Card) images using **YOLO** object detection and **PaddleOCR**.

## Project Structure

```
cnic_text_extraction/
├── app/
│   ├── __init__.py
│   ├── main.py                # FastAPI application & lifespan
│   ├── config.py              # Settings & configuration
│   ├── models/
│   │   ├── __init__.py
│   │   └── schemas.py         # Pydantic response models
│   ├── routes/
│   │   ├── __init__.py
│   │   └── extraction.py      # API endpoints
│   ├── services/
│   │   ├── __init__.py
│   │   ├── detector.py        # YOLO detection service
│   │   └── ocr.py             # PaddleOCR service
│   └── utils/
│       ├── __init__.py
│       ├── image.py           # Image upload utilities
│       └── parser.py          # CNIC field parser
├── best.pt                    # YOLO model weights
├── .env                       # Environment configuration
├── requirements.txt           # Python dependencies
├── run.py                     # Server entry point
└── README.md
```

## Setup

### 1. Install dependencies

```bash
pip install -r requirements.txt
```

### 2. Configure environment

Edit `.env` to customize settings (defaults work out of the box):

| Variable              | Default                      | Description                    |
|-----------------------|------------------------------|--------------------------------|
| `MODEL_PATH`          | `best.pt`                    | Path to YOLO model weights     |
| `DETECTION_THRESHOLD` | `0.15`                       | Min confidence for detection   |
| `OCR_LANG`            | `en`                         | PaddleOCR language             |
| `HOST`                | `0.0.0.0`                    | Server bind host               |
| `PORT`                | `8000`                       | Server bind port               |
| `MAX_FILE_SIZE_MB`    | `10`                         | Max upload file size           |

### 3. Run the server

```bash
python run.py
```

Or with uvicorn directly:

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## API Endpoints

### `POST /api/v1/extract`

Upload a CNIC image and get structured extracted data.

**Request:**
- Content-Type: `multipart/form-data`
- Body: `file` (image file — JPEG, PNG, BMP, WEBP)
- Optional query param: `threshold` (float, detection confidence)

**Example with cURL:**

```bash
curl -X POST "http://localhost:8000/api/v1/extract" \
  -F "file=@cnic_image.jpg"
```

**Example with Python:**

```python
import requests

url = "http://localhost:8000/api/v1/extract"
files = {"file": open("cnic_image.jpg", "rb")}
response = requests.post(url, files=files)
print(response.json())
```

**Response:**

```json
{
  "success": true,
  "message": "CNIC data extracted successfully.",
  "data": {
    "name": "Ayesha Khan",
    "father_name": "Asif Khan",
    "gender": "Female",
    "country_of_stay": "Pakistan",
    "identity_number": "12345-1234567-1",
    "date_of_birth": "03.11.1999",
    "date_of_issue": "09.11.2017",
    "date_of_expiry": "06.10.2024"
  },
  "raw_texts": [
    "Name Ayesha Khan",
    "Father's name Asif Khan",
    "..."
  ],
  "detection_info": {
    "total_regions_detected": 18,
    "detection_threshold": 0.15
  }
}
```

### `GET /api/v1/health`

Health check endpoint.

```bash
curl http://localhost:8000/api/v1/health
```

### `GET /docs`

Interactive Swagger UI documentation (auto-generated by FastAPI).

## How It Works

1. **Upload** — Client sends a CNIC image via multipart form
2. **Detection** — YOLO model detects text regions on the card
3. **Cropping** — Detected regions are cropped from the original image
4. **OCR** — PaddleOCR extracts text from each cropped region
5. **Parsing** — Regex-based parser maps raw text to structured CNIC fields
6. **Response** — JSON with both structured data and raw OCR output
